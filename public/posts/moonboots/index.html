<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>Moonboots :: Terminal</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="TL;DR I&rsquo;m releasing a tool I use while reversing: Moonboots, a shellcode injector with features like format-agnostic input, automatic cleanup, clipboard sourcing, shellcode idling, managed use support, and a plugin framework to easily implement new techniques.
The release is available on GitHub, and the full documentation on the repository&rsquo;s Pages.
Introduction Shellcode injection has long been a part of the malware authors&rsquo; cookbooks. Whether used as part of complex loading chains or to evade countermeasures, this technique is likely to remain relevant for a long time.
" />
<meta name="keywords" content=", " />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/moonboots/" />





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.b47161dde8ffa6ea2ecbbceebf3b57328f951e58e784731b59fedeb44524f5b8.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal_rusty.min.cb89cb80e0cadc3c82f9c155b1f5eb4df0b1e93402e5d3a0c4512796848b25d4.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Moonboots">
<meta property="og:description" content="TL;DR I&rsquo;m releasing a tool I use while reversing: Moonboots, a shellcode injector with features like format-agnostic input, automatic cleanup, clipboard sourcing, shellcode idling, managed use support, and a plugin framework to easily implement new techniques.
The release is available on GitHub, and the full documentation on the repository&rsquo;s Pages.
Introduction Shellcode injection has long been a part of the malware authors&rsquo; cookbooks. Whether used as part of complex loading chains or to evade countermeasures, this technique is likely to remain relevant for a long time.
" />
<meta property="og:url" content="http://localhost:1313/posts/moonboots/" />
<meta property="og:site_name" content="Terminal" />

  
  
  <meta property="og:image" content="http://localhost:1313/">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-02-15 18:55:56 &#43;0100 CET" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    ma111e
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/moonboots/">Moonboots</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-02-15</time><span class="post-author">ma111e</span><span class="post-reading-time">6 min read (1073 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="http://localhost:1313/tags/moonboots/">moonboots</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/tool/">tool</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/release/">release</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/shellcode/">shellcode</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/injection/">injection</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#tldr">TL;DR</a></li>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#moonboots1">Moonboots</a>
      <ul>
        <li><a href="#input">Input</a></li>
        <li><a href="#privileges">Privileges</a></li>
        <li><a href="#managed-use">Managed use</a></li>
        <li><a href="#quality-of-life">Quality of life</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <h2 id="tldr">TL;DR<a href="#tldr" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>I&rsquo;m releasing a tool I use while reversing: Moonboots, a shellcode injector with features like format-agnostic input, automatic cleanup, clipboard sourcing, shellcode idling, managed use support, and a plugin framework to easily implement new techniques.</p>
<p>The release is available on <a href="https://github.com/ma111e/moonboots">GitHub</a>, and the full documentation on the <a href="https://ma111e.github.io/moonboots/#/">repository&rsquo;s Pages</a>.</p>
<h2 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Shellcode injection has long been a part of the malware authors&rsquo; cookbooks. Whether used as part of complex loading chains or to evade countermeasures, this technique is likely to remain relevant for a long time.</p>
<p>Digging out shellcode during malware analysis is quite common. However, shellcode is often just a sequence of instructions, with no means of being loaded and run by the OS - which can be a problem for standard procedure like dynamic analysis.</p>
<p>There are many ways to run and analyze such piece of code independently. Still, I prefer to stay as close as possible to the malware’s actual operational context. I often choose either to patch the malware or to use debugger tricks to get a hold on the shellcode execution - but there have been many instances where a flexible loader that I know well could have saved me a lot of time.</p>
<p>Many loaders and injectors are available online, yet I have never found one I felt completely comfortable using. Moreover, some didn’t work as expected, wasting my time as I reviewed the code to determine whether my hypothesis was wrong or if I had made a mistake while using the tool.</p>
<p>Plus, I love to learn malware techniques by implementing them myself. And I love to write tools.</p>
<p>This is how I came to build Moonboots, the shellcode injector I&rsquo;m releasing here. I wrote this program a few years ago, when Golang was rapidly gaining popularity among malware authors. I chose to focus on implementing the injection techniques I encountered using pure Go, both to better understand the language’s constraints and to have a lab environment that was easy to use for research.</p>
<h2 id="moonboots1">Moonboots<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><a href="#moonboots1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>At its heart, this program is a shellcode injector: it takes shellcode as input and use a specific technique to inject it in a target. That&rsquo;s all.</p>
<p>However, I had two objectives in mind while building it:</p>
<ul>
<li>It must be as easy to use as I can think of</li>
<li>It must be extensible in such a way that it won&rsquo;t be a time sink when researching novel techniques and implementations</li>
</ul>
<h3 id="input">Input<a href="#input" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>One of the first pain point I wanted to address was the inconsistency in shellcode formats I came across. Converting <code>\xFF</code> to <code>0xFF</code> or <code>FF</code>, normalizing spaces and case, removing quotes and such have always felt like such a petty discomfort that I needed to handle it automatically. Nobody should waste time for that.</p>
<p>As such, Moonboots will guess the input format automatically<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>, may it be hex or raw bytes. It&rsquo;s also able to clean the input a bit, so you can actually copy/paste shellcode right from the output of a <code>xxd -p</code> command or from a C source code and feed it to it without any remorse.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> shellcode[] <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x31\xc0\x31\xdb\x31\xc9\x31\xd2</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x51\x68\x6c\x6c\x20\x20\x68\x33</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x32\x2e\x64\x68\x75\x73\x65\x72</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x89\xe1\xbb\x7b\x1d\x80\x7c\x51</span><span style="color:#e6db74">&#34;</span> <span style="color:#75715e">// 0x7c801d7b ; LoadLibraryA(user32.dll)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xff\xd3\xb9\x5e\x67\x30\xef\x81</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc1\x11\x11\x11\x11\x51\x68\x61</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x67\x65\x42\x68\x4d\x65\x73\x73</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x89\xe1\x51\x50\xbb\x40\xae\x80</span><span style="color:#e6db74">&#34;</span> <span style="color:#75715e">// 0x7c80ae40 ; GetProcAddress(user32.dll, MessageBoxA)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x7c\xff\xd3\x89\xe1\x31\xd2\x52</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x51\x51\x52\xff\xd0\x31\xc0\x50</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xb8\x12\xcb\x81\x7c\xff\xd0</span><span style="color:#e6db74">&#34;</span>;    <span style="color:#75715e">// 0x7c81cb12 ; ExitProcess(0)
</span></span></span></code></pre></div><blockquote>
<p><em>Yes, you can use this as input without any trouble</em></p></blockquote>
<p>I also added a flag to fetch the input from the clipboard because I am lazy. And it&rsquo;s kinda cool. But also a bit tricky. Is the shellcode that&rsquo;ll run the one that I copied or the one before ? Let&rsquo;s find out ⌐■_■. Maybe use this one with caution. Finding the right shellcode variation is so much easier tho. ¯\_(ツ)_/¯</p>
<p>Note that a &ndash;demo flag is available for testing and will inject a hardcoded calc.exe shellcode in its own memory. The actual shellcode is shown in moonboots&rsquo; help. Note that the <code>moonboots/demo/{arch}</code> folder contains examples of the supported file formats.</p>
<p>Some says that base64 is also supported, even though it needs to be explicitly specified via the CLI.</p>
<p>All the details about the detection and cleanup are available in the <a href="https://ma111e.github.io/moonboots/#/user_guide/quickstart">Quickstart</a> section of the documentation.</p>
<h3 id="privileges">Privileges<a href="#privileges" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Some shellcode techniques have hard requirements, like being run from a high integrity process or with specific privileges. Moonboots is able to enable any privileges specified, and to restart itself with high integrity if needed. Note that self enabling privileges will always trigger a auto-elevation.</p>
<h3 id="managed-use">Managed use<a href="#managed-use" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Shellcode injection is only one of many steps in analyzing a malware. Most of the times, we&rsquo;ll use several tools to cover specific parts of the analysis, often managed by an orchestration program, that will bridge the tools together and pass the data around.</p>
<p>For such use, Moonboots can be used as a custom shellcode loader by using a special flag that will take the name of a named pipe to which the process running the shellcode will be sent back upon creation.</p>
<p>See the <a href="https://ma111e.github.io/moonboots/#/developers/managed_use">Managed Use</a> section of the documentation for the full details and some boilerplate code.</p>
<h3 id="quality-of-life">Quality of life<a href="#quality-of-life" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>For those who might not be aware, <code>EB FE</code> is love, <code>EB FE</code> is life. This instruction means &ldquo;loop back (EB) to the previous byte (FE)&rdquo; - <em>aka</em> an infinite loop. Any Windows process running these two bytes will not advance to any further instruction, effectively halting the execution of the program without using any debugger feature - which is usually used to give us the time to attach ourselves after the anti-debugging checks have been passed.</p>
<p>Regarding shellcode injection however, it has another very interesting use: halting the running of the shellcode right after it has been injected. This is often useful when the shellcode is injected in a remote process or through complex means that cannot be followed easily with a debugger.</p>
<p>That&rsquo;s why Moonboots has a flag that will prepend these 2 bytes to the shellcode before injecting it, allowing us to attach ourselves to the injected process while it&rsquo;s waiting for us to resume execution.</p>
<p>See the <a href="https://ma111e.github.io/moonboots/#/developers/managed_use">Idle</a> section of the documentation for more details.</p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>The tool is available on <a href="https://github.com/ma111e/moonboots">GitHub</a>, and the full documentation on the <a href="https://ma111e.github.io/moonboots/#/">repository&rsquo;s Pages</a>.</p>
<p>Issues and pull requests are welcomed.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Why &ldquo;Moonboots&rdquo; ? Because there had to be a name - and I love moonboots. Malware would 100% look cooler in moonboots.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Note that custom shellcode crafted through deep madness (e.g. <a href="https://www.usenix.org/system/files/woot20-paper-patel_0.pdf">https://www.usenix.org/system/files/woot20-paper-patel_0.pdf</a>) might defeat the auto-detection feature. In this case, the encoding should be manually specified via the CLI.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </div></div>

  
    

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
